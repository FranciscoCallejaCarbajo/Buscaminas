<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Buscaminas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- CSS -->
    <!-- <link rel="stylesheet" href="/css/estyleTablero.css"> -->
</head>
<body oncontextmenu="return false">
    <!-- CSS -->
    <style>
      *{
    transition: all 1s;
    box-sizing: border-box;
    }

    body{
        font-family: calibri;
        margin: 0;
        padding: 0;
        user-select: none;
        background: lightsteelblue;


    }

    table{

        background: slategray;
        margin: auto;
    }

    td{

        border: rgba(0, 0, 0, 0.25)1px solid;
        text-align: center;
        font-size: 120%;
        color: white;
        box-shadow: inset 3px 3px 0 0 rgb(255, 255, 255, 0.5),
            inset -3px -3px 0 0 rgba(0, 0, 0, 0.25)
    } 
    </style>


    <!--HTML-->

    <table cellspacing = 0 callspadding =0 id="tablero">
        <tr>
            <td>A</td>
            <td>B</td>
        </tr>
        <tr>
            <td>C</td>
            <td>D</td>
        </tr>
    </table>
    

    <!--javascrip-->

    <script>
      let filas = 20;
        let columnas = 20;
        let lado = 30;

        let marcas= 0;

        let minas = filas*columnas*0.1;

        let tablero = [];

        let enJuego = true;

        let juegoIniciado = false;

        nuevoJuego();

        function nuevoJuego(){
            generacionTableroHTML();
            añadirEventos();
            generarTableroJuego();
            refrescarTablero();
        }

        function generacionTableroHTML(){

        let html = "";
        for(let f = 0; f < filas;f++){
            html += `<tr>`
            for(let c = 0; c < columnas;c++){
                html += `<td id="celda-${c}-${f}" style="width:${lado}px;height:${lado}px">`
                html += `</td>`;

            }
            html += `</tr>`;

        }

        let tableroHTML = document.getElementById("tablero");
        tableroHTML.innerHTML = html
        tableroHTML.style.width = columnas*lado+"px";
        tableroHTML.style.height = filas*lado+"px";


    }

    function añadirEventos(){
        for (let f = 0; f < filas; f++) {
            for (let c = 0; c < columnas; c++) {
                let celda = document.getElementById(`celda-${c}-${f}`)
                celda.addEventListener("dblclick",(me)=>{
                    dobleClic(celda, c, f, me);

                })
                celda.addEventListener("mouseup",(me)=>{
                    clicSimple(celda, c, f, me);

                })
                
            }
            
        }

    }

    function dobleClic(celda, c, f, me) {
        
        if(!enJuego){
            return
        }

        refrescarTablero()


    }

    function clicSimple(celda, c, f, me) {
        if(!enJuego){
            return
        }
        if(tablero[c][f].estado == "descubierto"){

            return
        }
        switch (me.button) {
            case 0:// 0 es el codigo para el clic izquierdo
                if(tablero[c][f].estado == "marcado"){
                    break
                }
                /*para proteger que el primer click no sea una mina vamos a hacer este while*/
                while (!juegoIniciado && tablero[c][f].valor == -1) {
                    generarTableroJuego()
                }
                tablero[c][f].estado = "descubierto";
                juegoIniciado = true;
                break;
            case 1://1 es el codigo para el clic medio o scroll
                break

            case 2://2 es el codigo para el clic derecho
            //Apartado marcado y desmarcado de la bandera
                if(tablero[c][f].estado == "marcado"){
                    tablero[c][f].estado = undefined;
                    marcas--
                    //desmarcar
                }else{
                    tablero[c][f].estado = "marcado";
                    marcas++;
                    //marcar
                }
                break
        
            default:
                break;
        }
        refrescarTablero();

    }

function refrescarTablero() {
      for (let f = 0; f < filas; f++) {
        for (let c = 0; c < columnas; c++) {
          let celda = document.getElementById(`celda-${c}-${f}`)
          if (tablero[c][f].estado == "descubierto") {
            celda.style.boxShadow = "none"
            switch (tablero[c][f].valor) {
              case -1:
                celda.innerHTML = `<i class="fas fa-bomb"></i>`
                celda.style.color = "black"
                celda.style.background = "red"
                break;
              case 0:
                break
              default:
                celda.innerHTML = tablero[c][f].valor
                break;
            }
          }
          if (tablero[c][f].estado == "marcado") {
            celda.innerHTML = `<i class="fas fa-flag"></i>`
            celda.style.background = `blue`
          }
          if (tablero[c][f].estado == undefined) {
            celda.innerHTML = ``;
            celda.style.background = ``;
          }
        }
    }
}
    //doble for para verificar si el jugador perdio
    function verificarGanador() {

        for (let f = 0; f < filas; f++) {
            for (let c = 0; c < columnas; c++) {
                
                
            }
            
        }
        
    }

    function verificarPerdedor(){


    }


    function generarTableroJuego(){
        vaciarTablero();
        ponerMinas();
        contadoresMinas();

    }

    function vaciarTablero(){
        tablero = [];
        for (let c = 0; c < columnas; c++) {
            tablero.push([]);
            
        }


    }

    function ponerMinas(){
        for (let i = 0; i < minas; i++) {
            let c;
            let f;
            
            do {
                c = Math.floor(Math.random()*columnas);
                f = Math.floor(Math.random()*filas);
                
            } while (tablero[c][f]);
            tablero[c][f] = {valor: -1};


        }

    }

    function contadoresMinas(){

        for(let f = 0; f < filas;f++){
            for(let c = 0; c < columnas;c++){
                if (!tablero[c][f]) {
                    let contador = 0;
                    for (let i = -1; i <= 1; i++) {
                        for (let j = -1; j <= 1; j++) {
                            if(i==0&&j==0){
                                continue
                            }
                            try {
                                if(tablero[c+i][f+j].valor==-1){
                                    contador++;
                                }
                            } catch (e){ }
                        
                        }
                        
                    }
                    tablero[c][f] = {valor: contador};
                    
                }
            }
        }
    }

    </script>
</body>
</html>